<html>
  <head>
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="delicious.js"></script>
    <script type="text/javascript">
      //hack to register bookmark listener
      chrome.bookmarks.get('0', function() {});
      function bookmarkFoldersAsTags(bookmark) {
        var tags = [];
        
        //TODO: walk heirarchy of folders
        // var mark = bookmark;
        // while (mark.parentId) {
        //   chrome.bookmarks.get(mark.parentId, function(results) {
        //     if (results.length === 1) {
        //       mark = results[0];
        //       tags.push(mark.title);
        //     }
        //   });
        // }
        return tags.join(' ');
      }

      chrome.bookmarks.onCreated.addListener(function(id, bookmark) {
        if (bookmark.url) {
          delicious.saveBookmark({url: bookmark.url, description: bookmark.title, tags: bookmarkFoldersAsTags(bookmark)});
        }
      });
    </script>
  </head>
  <body>
  </body>
</html>
